# 2.4 Best Standards and Practices #

# CakePHP Basics 

We are using CakePHP version 3.x, which is significantly different
from the 2.x version of CakePHP.  As such, please make sure when
browsing online help that you are looking at help for CakePHP version
3.

## CakePHP File Structure

### Model ###

The `Model` directory contains three subdirectories which make up the
model.

1. `Table`
2. `Entity`
3. `Behavior`

Model files use the `.php` extension.

#### Table ####

Table objects provide access to the collection of entities stored in a
specific table.  This is similar to the standard Model in MVC.

The table file name is the plural controller name followed by "Table"
(e.g. `UsersTable.php`).

#### Entity ####

Entities represent individual rows or domain objects in the app.

The entity file name is the singular controller name
(e.g. `User.php`).

#### Behavior ####

Behaviors are used for packaging behaviors that are common across many
models.

### Template (View) ###

The template (view) files use the `.ctp` file extension.

The view files go in "Template/PLURAL CONTROLLER NAME"
(e.g. `Template/Users`).

Views must have a function in the controller in order to be rendered.

### Controller ###

The controllers use the `.php` file extension.

The `AppController.php` file comes with the install of CakePHP.

The Controller is plural (e.g. `UsersController.php`).

# Git Basic Commands

### Clone a repo ###

    git clone <repo name> [destination]

For example:

    git clone https://github.com/csi4999-mims/documentation.git

(The `[destination]` is optional.)

### Get the latest from the repo ###

    git pull

### Check for unstaged changes ###

    git status

### Stage changes ###

    git add -A

OR

    git add

### Commit changes ###

    git commit -m "my commit message"

### Push changes ###

    git push  

# Bootstrap Helper Documentation  

    https://holt59.github.io/cakephp3-bootstrap-helpers/  

## Installation  
    To install the Bootstrap Helper for CakePHP you need to run the following
    commands or add the following code:  

    ~~~
    composer require holt59/cakephp3-bootstrap-helpers:dev-master  
    ~~~  

Add this line to `/config/bootstrap.php`:  

    ~~~
    Plugin::load('Bootstrap');  
    ~~~  
Add these lines to `AppController.php`:  

    ~~~
    public $helpers = [
        'Form' => [
            'className' => 'Bootstrap.Form'
        ],
        'Html' => [
            'className' => 'Bootstrap.Html'
        ],
        'Modal' => [
            'className' => 'Bootstrap.Modal'
        ],
        'Navbar' => [
            'className' => 'Bootstrap.Navbar'
        ],
        'Paginator' => [
            'className' => 'Bootstrap.Paginator'
        ],
        'Panel' => [
            'className' => 'Bootstrap.Panel'
        ]
    ];  
    ~~~  

Add these lines to `Layout/default.ctp`:  

    ~~~
    <?php
    echo $this->Html->css('https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css
    /bootstrap.min.css');
    echo $this->Html->script([
        'https://code.jquery.com/jquery-1.12.4.min.js',
        'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'
    ]);
    ?>  
    ~~~  

## Using the Helpers  
### Modal Helper  

    A modal is a window that can dynamically pop up when you specify it to. For
    example when someone presses a button on the screen a modal can pop up.  

#### Modal using CakePHP Syntax  

    https://holt59.github.io/cakephp3-bootstrap-helpers/modal-helper/basics/  

    ~~~  
    <?php
        // Start a modal with a title, default value for 'close' is true
        echo $this->Modal->create("My Modal Form", ['id' => 'MyModal1',
        'close' => false]) ;
    ?>
    <p>Here I write the body of my modal !</p>
    <?php
        // Close the modal, output a footer with a 'close' button
        echo $this->Modal->end() ;
        // It is possible to specify custom buttons:
        echo $this->Modal->end([
            $this->Form->button('Submit', ['bootstrap-type' => 'primary']),
            $this->Form->button('Close', ['data-dismiss' => 'modal'])
        ]);
    ?>  
    ~~~  

#### Modal using standard HTML Syntax  

    ~~~  
    <!-- Example Button trigger modal -->
    <button type="button" class="btn btn-primary example-button"
    data-toggle="modal" data-target="#exampleModal">
      comment
    </button>  

    <!-- Example Modal -->
    <div id="MyModal1" tabindex="-1" role="dialog" aria-hidden="true"
    aria-labbeledby="MyModal1Label" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header ">
                    <!-- With 'close' => true, or without specifying:
                    <button type="button" class="close" data-dismiss="modal"
                    aria-hidden="true">×</button> -->
                    <h4 class="modal-title" id="MyModal1Label">Example 1 -
                    Simple header & footer, custom body</h4>
                </div>
                <div class="modal-body ">
                    <p>Here I write the body of my modal !</p>
                </div>
                <div class="modal-footer ">
                    <button class="btn btn-primary btn-primary" type="submit">
                    Submit</button>
                    <button data-dismiss="modal" class="btn btn-default"
                     type="submit">Close</button>
                </div>
            </div>
        </div>
    </div>  
    ~~~~  

# Google Maps API Helper Documentation  

    https://github.com/marcferna/CakePHP-GoogleMapHelper/tree/CakePHP3  

## Installation  
1) Download the files from Github  

2) Place the helper file (`GoogleMapsHelper.php`) into the following location:  
    `src/View/Helper/`  

3) Add this line to the controller associated with the view you will
    place the Google Map on:  
    `public $helpers = array('GoogleMap');`  

4) Add the JavaScript files to the associated view:  
    `<?= $this->Html->script('http://maps.google.com/maps/api/js?key=
    YOUR_API_KEY&sensor=true', [false]); ?>`  
    * Get the API Key from Nicole  

5) In the view add this line:  
    `<?= $this->GoogleMap->map(); ?>`  

6) Modify the map options with the follow code in the specific view:  
    `      <?=
            // Override any of the following default options to customize your map
            $map_options = array(
              'id' => 'map_canvas',
              'width' => '600px',
              'height' => '600px',
              'style' => '',
              'zoom' => 10,
              'type' => 'ROADMAP',
              'custom' => null,
              'localize' => true,
              'latitude' => 42.6666979,
              'longitude' => -83.399939,
              'marker' => true,
              'markerTitle' => 'This is my position',
              'markerIcon' => 'http://google-maps-icons.googlecode.com/
              files/home.png',
              'markerShadow' => 'http://google-maps-icons.googlecode.com/
              files/shadow.png',
              'infoWindow' => true,
              'windowText' => 'My Position',
              'draggableMarker' => false
            );
          ?>
          <?= $this->GoogleMap->map($map_options); ?>`

7) Add markers for each report in the database:  
    `<?php foreach ($reports as $report): ?>
        <?= $this->GoogleMap->addMarker("map_canvas", 1,
        $report->get('FamilyStreet')); ?>
    <?php endforeach; ?>`  

# Android Studio with Database Integration

## Connecting to a MySQL database using PHP/MySQL Workbench

### JDBC Package ###

https://www.tutorialspoint.com/android/android_php_mysql.htm

A SQL database can be connected to by the android app utilizing the JDBC package, and will use MySQL to query the database.
Having the android device/application access the database directly is not recommended, Android applications can be decompiled, giving a client the credentials to access the database, which is a security risk.
Having the client open a physical database connection will take a considerable amount of time, especially if the user is located far from the server.

### Provider Service ###

https://developer.android.com/reference/java/security/Provider.Service.html

In order to solve the problems with this method, it will be necessary to have a Service Provider Application, which will create and distribute the web services to the client. With this method authentication and authorization can be controlled better.

### SSL with mySQL Workbench ###

https://developer.android.com/training/articles/security-ssl.html

Currently in our project we are using Putty to create an SSH tunnel with MySQL workbench to access the database. Ideally in the Secure Sockets Layer (SSL), we will want to make use of key rotation to strengthen the security involved with public and private key exchanges. 

## Website Integration with Mobile Applications

### Web Views ###

https://github.com/futurice/android-best-practices#webviews 

Now that the mobile application will require connectivity to the website, the app must utilize webViews in order to pull information from the site, and database. The pitfall to be aware of with this approach is not to handle the html processing client-side, which can result in the webViews leaking memory. The implementation for these functions are best handled with the back-end html, or making better use of the platform’s widgets.

### Continuous Integration ###

https://github.com/futurice/android-best-practices#use-continuous-integration-1 

Considering the web application side is still under construction, and will likely have updates as time goes on, the mobile application must be able to reflect those changes, and ensure it is running the same framework. Continuous integration of the mobile application can provide a variety of useful functions, such as running static code, providing code analysis tools, and handling the generation and distribution of APK files.

### Proguard ###

https://github.com/futurice/android-best-practices#proguard-configuration 

Lastly, we might consider implementing utilities such as proguard or dexguard, for the purpose of obfuscating our code, and shrinking the overall package size. The main purpose of this would to be to better optimize the application for use on a mobile device.
